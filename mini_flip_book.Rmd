---
title: "---Learning Data Manuplation----"
subtitle: "With flipbookr and xaringan"
author: "<br><br>Phanikumar S Tata"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    css: [default, hygge, ninjutsu]
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r xaringanExtra-share-again, echo=FALSE}
xaringanExtra::use_share_again()
```


```{r, eval = F, echo = F}
library(tidyverse)
"https://images.unsplash.com/photo-1584717900604-56cd6daf54f5?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=633&q=80" %>% 
  magick::image_read() %>% 
  magick::image_rotate(90) %>% 
  magick::image_write("broom.jpg")
```





class: left, top, inverse
background-image: url(broom.jpg)
background-size: cover

# .large[Data Cleaning]
### Walk-throughs <br>with {flipbookr}<br>and {xaringan}

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>


#### .right[Phanikumar <br>Photo Credit: Zoya Loonohod]

```{r, include = F}
# This is the recommended set up for flipbooks
# you might think about setting cache to TRUE as you gain practice --- building flipbooks from scratch can be time consuming

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.height = 6, out.width = "100%", comment = " ", cache = T , warning = F, message = F)


library(flipbookr)
library(tidyverse)
library(clinicalfd)
library(xaringanExtra)
library(here)
```




# Hi!

--

This 'minimal flipbook' template has a couple of classic examples to get you building your first data manipulation flipbooks!

--

flipbooks are code-movies.  The frames of the movies are slides. Here we use the R package {xaringan} to create a remark.js slideshow. 

--

Slide breaks are indicated with `---` (be careful trailing white space is not allowed)

--

flipbookr's `chunk_reveal()` disassembles a single code chunk and creates the "build" of multiple partial-code chunks on different slides (the --- is automatically generated for you too).  

--

We use `chunk_reveal()` it 'inline', not in a code chunk. 

--

Let's start!



---
class: inverse, middle, center


# First up: classic flipbook, using defaults to walk through code pipeline

---

# Introduction

Data cleaning is the pits.  Or is it?  The cleaning tools of the `tidyverse` and other packages like `janitor` might help such tasks become less terrible -- and more fun! Let's look at a couple of examples. 



---

# Getting started with R and RStudio

The tools demonstrated in this book are implemented in the statistical software, R which is opensource and freely available.  RStudio, an integrated development environment (IDE), is a nice environment for working in R.  The following links may help you get R and RStudio up and running. 

- [Install Windows](https://www.youtube.com/watch?v=aCRMhAWmtpw)
- [Install Mac](https://www.youtube.com/watch?v=GLLZhc_5enQ)


---

# Acknowledgements

I'm grateful to the tidyverse team for their tireless work on developing and maintaining this wonderful toolkit and to RStudio for supporting the development I'm *very* grateful to them for their work on this as well as to Yihui Xie and others for their work on the Xaringan package --- the extraordinary platform for creating the slides for this book. 
---

# Preliminaries

This book covers some examples of getting data into R and cleaning it.  There are about 5 steps involved as follows:

- Step 0: Identifying data of interest
- Step 1: Saving this data to your raw_data folder
- Step 2: Scanning the data into R and assigning an object like *the_data_raw*
- Step 3: Cleaning the data and assigning to an object like *the_data*
- Step 4: Saving out the clean data in a data_products folder
- Step 5: Loading your clean data - ready for analysis! 

---

# Open your project in RStudio

It's helpful to use RStudio projects. The way to create a final_project is to use Menu options in R Studio.  In RStudio, you can navigate to it from the right hand corner icon.  In the example, here, I'm currently in a project called `oct_n_pres` 

Steps to start new project 
1) Up Left side click on File 
![](figures/00_project_setup.png)

2) Click on the Open Project , 

![](figures/navigate_to_project.png)


---

3) Then Click on New Directory


![](figures/01_project_setup.png)
---

 Click on either New Project ( If you do not have a Directory (Windows Folder))

 ![](figures/02_project_setup.png)

---
click on the New Directory `**~**`  represents my documents folder on windows ) 
  
  ![](figures/03_project_setup.png)
---

Or if you have existing folder  then use , here you see 

1.  **~** --> My Documents folder
2.  Create Project --  creates new directory (windows folder  )
3.  Open in new session --> Opens new R session ( does not affect the program you are working)

 ![](figures/06_project_setup.png)

---
# Folder structure on windows 
Type *R Project (.Rproj)* is R project file which stores more than just .Rmd file . By clicking the file all the related files get opened too . Very easy and nice of saving the R files

![](figures/07_project_setup.png)

---
# Project structure


![](figures/project_file_structure.png)

Steps 1-4 (maybe just 2-4) will happen in the 01_cleaning_data.Rmd, and Step 5 will happen in 02_analysis.Rmd.  

---

# Project structure

Another way to show this is with a directory tree as shown here:    
```
Dev
├── Codelist   <- This may not relvent in Validated R 
├── data       <- Folder  
├── Docum      <- This may not relvent in Validated R
├── logs           <- This may not relvent in Validated R
├── functions      <- Folder
├── metadata       <- This may not relvent in Validated R
├── Programs       <- Folder
    ├── 01_data_cleaning.Rmd   <- work files
    ├── 02_analysis.Rmd        <- work files
    ├── final_project.Rproj    <- you declared your project
├── results        <- Output Folder 
```

---
```{r}
library(here)
?here()
adsl <- clinicalfd::adsl
here::here('codelist')
#here::here("data" , "adsl")
```
---

## Using file.exists to get the Location and dir.create to create a required folder 
```{r}
folder <- "Programs"

if (file.exists(folder)) {
 cat("The folder already exists")
} else {
 dir.create(folder)
}
```
---
## Using Here Library to create a required folder 
```{r}
library(here)

if (!dir.exists(here('results'))) 
  {dir.create(here('results'))}
```

---

# R: HOW TO CREATE, DELETE, MOVE, AND MORE WITH FILES

Though Python is usually thought of over R for doing system administration tasks, R is actually quite useful in this regard. In this post we’re going to talk about using R to create, delete, move, and obtain information on files.


- [Basic tasks using R](http://theautomatic.net/2018/07/11/manipulate-files-r/)

---

# Assignment Operators 

The operator **"<–" is equivalent to "=" sign. for creating a vector, Equal to "="**

**"<-" , "<<-" , "->" , "->>" , "=" all these assignment operators **
**Use ";"  to write two R statements write next to each other **

There are three different assignment operators: two of them have leftwards and rightwards forms.

The operators <- and = assign into the environment in which they are evaluated. 

The operator <- can be used anywhere, whereas the operator = is only allowed at the top level (e.g., in the complete expression typed at the command prompt) or as one of the subexpressions in a braced list of expressions.

The operators <<- and ->> are normally only used in functions, and cause a search to be made through parent environments for an existing definition of the variable being assigned. 

If such a variable is found (and its binding is not locked) then its value is redefined, otherwise assignment takes place in the global environment.


---

#### The left assign <- 

![](figures/left_as.png)


---

#### The Equal assign =

![](figures/equal_assig.png)

---

#### The right assign -> 

![](figures/right_assig.png)

---
<br>
<br>

##                Use R as caliculator 
Here is how you can simply type in your numbers for all your calculations 

![](figures/caliculator.png)

---

`r chunk_reveal("basic")`

```{r basic, include=F}

1 + 1

5 * 8

(4 + 2)^2

3 / (3 + 6)

```

---
##Data Types in R

![](figures/01data_types.png)


Vector (1x1 Matrix ; Data type : All one type either NUM or Char) .Matrix( 2x2 (or more) Matrix ; Data type : All one type either NUM or Char). List(Data Type : All types data (NUM and/or CHAR)).Data Frame (Data Type : Either Num or Char and more than 1x1 Collection of vectors)

---


##Data Types in R (Contd..)

Individual data values can be grouped together into containers . The main types of containers we  use are vectors , lists and data tables ( dataframe or Tibbles )

Scalar ---- Basic unit Ex ( s <- 1 , s <- "Scalar" )

Vector : A vector in R is like vector in Mathematics: a set of ordered elements, All the   elements in a vector or of same data type (either numeric , character or Logical). You can create vector by enclosing the elements in the R function **c()**  .  

Ex: c(1,2 , 3 ,NA , 5) ; c("R is Cool")
    
c("We have more than 1000 R programmers in our company")  <---- This is Okay as 1000 is Char

c(1000 , "programmers") + 1  <- might throw an **ERROR**  as they are two different types
    
    
    
---

##### NOTE : You can't Mix data types in a vector . If you mix them R will **COERCE** them so that they are all the same. COERCE in R means **Automatic conversion** from one datatype to another.So if you mix the numeric and character type then Numbers are coerced to characters so 10 will "10"

![](figures/coercion.png)
---
## Lists

To solve the above problem (to have more than one datatype),we have datatype called **Lists** declared using **list()** . Lists are the R objects which contain elements of different types like integer, strings, vectors , matrix and list inside list

data_type <- list (integer = 1000 , character = "programmers" );data_type  # Will print 

![](figures/list.png)   

---

You can refer to elements of list using square brackets like a vector , but you can also use the **$** sign notation to refer to items in the list
 
see below to refer to  int and Integer in the data_type list use 

Ex: multiplication <- data_type**$**int; <- data_type**$**integer

![](figures/list_multi.png)  

---


## **Data Frames**

![](figures/dataframe.png)

A data Frame is list of vectors which are of equal length .R matrix contains only one type of data while data frame accepts different data types ( Numeric, Char , Factor)


---


#### How to Create a Date Frame 

data.frame (df , stringsAsFactors = TRUE )

df : it can be Matrix or vector or anything else 

Example of creating a data frame 


![](figures/01_dataframe.png)
---


##Basic data types

Unlike SAS and SPSS, R has several different data types (structures) including vectors, factors, data frames, matrices, arrays, and lists. The data frame is most like a dataset in SAS.

Data can be numbers, words, true/false values or combinations of these. In order to understand some later concepts, it's useful to have a basic understanding of data types in R: numeric, character, and logical

![](figures/all_data_types.png)


---


**Numeric Data Type**

|      structure
|-----------------------------------------------
|     Integer             ex: typeof(10)
|     double              ex: typeof(10.0)
|     Integer             ex: typeof(10L)
|     complex             ex: typeof(10i)
|------------------------------------------------
### Useful R functions 

typeof()         ------ Gives if it is a Integer , Double , Complex Etc 
is.numeric()     ------ Gives TRUE or FALSE


A vector can either be Numeric or Character or factor . Data types in R are referred to as "class" . The class command is used to find what type of data it is .


Try ;

x  <- 10 ; class(x) ; 

"AB" -> C;  class(c)
 
---


### Numeric vector


`r chunk_reveal("nvect" , include = FALSE, eval = FALSE) `

```{r nvect}

x <- c(1,2,3,4,5,6) ; class(x)

a1 = 10             ; class(a1)

b1 <- 11            ; class(b1)

```

---
<br>
<br>

 
**Character Data Type **

data type      |      structure
---------------|----------------
               |    ex: typeof("Character string (with two Quotes) ")
               |    **Character Strings are any Text between Quotation mark**

<br>
<br>

### Character vector 
Character vectors need **Quotes** to indicate that they are *CHAR*

---

`r chunk_reveal("cvect")`

```{r cvect, include=F}
x <- c("Mon" , "TUE" , "Wed");  class(x)

a1 = "THUR" ;   class(a1)


weekday <- c("Mon" , "TUE" , "Wed" , "Mon" , "Tue" , "Wed"); class(weekday ) 

# Getting the Count of Week days , See TUE and Tue 
# are counted differently as R is case sensitive

table(weekday)


# b1 <- FRI  This gives an ERROR
#class(b1)

```

---
<br>
<br>
<br>
<br>

# Examples of Creating different Types Vectors 

---

`r chunk_reveal("vec")`

```{r vec, include=F}
3:10

1:6 * 2

c(1, 2, 6, 10)


1:4 + 0:3

c(1, 2, 3, 4) + c(0, 1, 2, 3) 

TRUE

c(T, T, F, F)

"hello world"

c("hello", "hi", "bye", "bye-bye")

NULL

factor(c("hello", "hi", "bye", "bye"))

factor(c("hello", "hi", 
         "bye", "bye"), 
       levels = c("hi", "hello", 
                  "bye", "bye-bye"))
```
 



---
class: inverse, middle, center
# First up: classic flipbook, using defaults to walk through code pipeline
<!-- get a flipbook version of the my_cars code chunk - pauses are where parentheses are balanced -->
---

`r chunk_reveal("my_cars")`

```{r my_cars, include = FALSE}
head(adsl)

cars %>%
  filter(speed > 4) %>%
  ggplot() +
  aes(x = speed) + #BREAK
  aes(y = dist) + #BREAK
  geom_point(
    alpha = .8, 
    color = "blue" 
    ) + 
  aes(size = speed) #BREAK
```

---
class: inverse, center, middle


# Next up:  refer to same chunk, but use user defined breakpoints, and display output only


<!-- get another flipbook version of the my_cars code chunk, this time at the defined breaks and only showing output -->
---

`r chunk_reveal("my_cars", break_type = "user", display_type = "output", title = "### user defined break! using #BREAK message")`



---
class: inverse, center, middle

# Next up:  cycle through different lines of code





<!-- get flipbook that rotates through lines, my_fill -->
---

`r chunk_reveal("my_fill", break_type = "rotate", widths = c(1,1), title = "### cycle through lines of code marked #ROTATE")`

```{r my_fill, eval = F, echo = F}
ggplot(data = cars) +
  aes(x = speed) +
  aes(y = dist) +
  geom_point(size = 8,
             shape = 21,
             alpha = .9,
             color = "snow") +
  aes(fill = speed) +
  scale_fill_viridis_c(option = "magma") + #ROTATE
  scale_fill_viridis_c(option = "cividis") + #ROTATE
  scale_fill_viridis_c(option = "plasma") #ROTATE
```


---
class: inverse, center, middle

# Next up:  look at multiple realizations of same code





<!-- get flipbook that shows multiple realizations of the same code -->
---

`r chunk_reveal("cars_multi", break_type = 5, title = "### see multiple realizations of code")`

```{r cars_multi, include = FALSE}
cars %>% 
  sample_frac(size = 1, replace = TRUE) %>%      
  ggplot() +              
  aes(x = speed) +
  aes(y = dist) +
  geom_count(
    alpha = .7,
    color = "blue",
    size = 4
    ) + 
  geom_smooth(method = lm, se = FALSE) +
  coord_cartesian(xlim = range(cars$speed),
                  ylim = range(cars$dist)) +
  theme(legend.position = c(.9, .2))
```


---

`r chunk_reveal("test", left_assign = "detect")`

```{r test, include=FALSE}
# hello
jam <- "hi"
```



<!-- adjust font size in this css code chunk, currently 80 -->

```{css, eval = TRUE, echo = FALSE}
.remark-code{line-height: 1.5; font-size: 80%}

@media print {
  .has-continuation {
    display: block;
  }
}

code.r.hljs.remark-code{
  position: relative;
  overflow-x: hidden;
}


code.r.hljs.remark-code:hover{
  overflow-x:visible;
  width: 500px;
  border-style: solid;
}
```



---

# Notes: 

- This minimal flipbook assumes you are online when you build and view.  It is going to find the most recent remark.js info online.

- xaringan/remark.js slideshows are not self contained, single file slide shows.  Make sure you ship all the associated files that are created to display your flipbooks/slideshows.  I like to push .html and associated files to github repository and use Github Pages to host for beyond local sharing. :-)

